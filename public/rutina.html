<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/public/css/rutinas.css">
</head>
<body>

<nav class="navbar">
    <div class="logo-container">
        <a href="indexprofesor.html" class="logo-text">Anima App</a>
    </div>

    <div class="menu-toggle" id="mobile-menu">
        <span class="bar"></span>
        <span class="bar"></span>
        <span class="bar"></span>
    </div>

    <ul class="nav-links">
        <li><a href="/public/indexprofesor.html">Inicio</a></li>
        <li><a href="/public/alumno.html">Alumnos</a></li>
        <li><a href="/public/rutina.html" class="active">Rutinas</a></li>
        <li><button class="btn-cerrar-sesion" onclick="cerrarSesion()">Cerrar Sesión</button></li>
    </ul>
</nav>

<main>
    <header class="header-section">
        <h1>Gestión de Rutinas</h1>
        <p>Seleccioná un alumno para asignar o editar su plan de entrenamiento.</p>
    </header>

    <div class="search-bar">
        <input type="text" id="busquedaAlumno" placeholder="Buscar alumno por nombre...">
    </div>

    <div class="tabla-container">
        <table id="tablaRutinas">
            <thead>
                <tr>
                    <th>Alumno</th>
                    <th>Última Actualización</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="listaAlumnosRutinas">
                </tbody>
        </table>
    </div>
</main>


<script>

    function cerrarSesion() {
    // Borramos los datos del profesor del almacenamiento local
    localStorage.removeItem('usuarioLogueado');
    // Redirigimos al index (o login)
    window.location.href = 'sesion.html'; 
}



    var ejerciciosDelPlanActual = [];




async function cargarEjerciciosDelPlan() {
    const idPlan = document.getElementById('selectorPlanes').value;
    const selectorEjercicios = document.getElementById('selectorEjercicios');

    if (!idPlan) return;

    try {
        const res = await fetch(`http://localhost:3000/api/obtener-rutina-detalle/${idPlan}`);
        
        // Verificamos si la respuesta es OK antes de convertir a JSON
        if (!res.ok) throw new Error("Error en la ruta del servidor");

        const datos = await res.json();
        
        // Guardamos en la variable global
        ejerciciosDelPlanActual = datos;
        
        console.log("Ejercicios cargados:", ejerciciosDelPlanActual);

        // Habilitamos y actualizamos la lista
        selectorEjercicios.disabled = false;
        actualizarListaPorDia();

    } catch (error) {
        console.error("Error al cargar ejercicios:", error);
        alert("No se pudieron cargar los ejercicios. Verifica la ruta en el servidor.");
    }
}

// 3. Función de filtrado
function actualizarListaPorDia() {
    // Verificamos que la variable exista y tenga datos
    if (!ejerciciosDelPlanActual) return;

    const diaSeleccionado = document.getElementById('filtroDiaEditar').value;
    const selectorEjercicios = document.getElementById('selectorEjercicios');
    
    const filtrados = ejerciciosDelPlanActual.filter(ej => 
        ej.dia && ej.dia.toString().trim().toLowerCase() === diaSeleccionado.toLowerCase()
    );

    selectorEjercicios.innerHTML = '<option value="">-- Seleccione un ejercicio --</option>';

    if (filtrados.length > 0) {
        filtrados.forEach(ej => {
            const opt = document.createElement('option');
            opt.value = ej.id;
            opt.textContent = ej.nombre_ejercicio;
            selectorEjercicios.appendChild(opt);
        });
        selectorEjercicios.disabled = false;
    } else {
        selectorEjercicios.innerHTML = `<option value="">No hay ejercicios para el ${diaSeleccionado}</option>`;
        selectorEjercicios.disabled = true;
    }
}






    document.getElementById('mobile-menu').addEventListener('click', function() {
    const navLinks = document.querySelector('.nav-links');
    navLinks.classList.toggle('active');
    
    // Opcional: animación simple de las barras
    this.classList.toggle('is-active');
});


document.addEventListener('DOMContentLoaded', () => {
    const profeId = localStorage.getItem('usuarioId'); 
    
    if (!profeId) return;

    fetch(`http://localhost:3000/api/rutinas/${profeId}`)
        .then(res => res.json())
        .then(data => {
            const tbody = document.getElementById('listaAlumnosRutinas');
            tbody.innerHTML = '';

            data.forEach(alumno => {
                const tr = document.createElement('tr');
                
                // Lógica de fecha: Si no hay fecha de rutina, mostramos el mensaje
                let fechaAMostrar = "Sin rutina asignada";
                
                // IMPORTANTE: Aquí usa el nombre de la columna de tu DB que guarda la fecha de la RUTINA
                if (alumno.ultima_rutina_fecha) { 
                    const soloFecha = alumno.ultima_rutina_fecha.substring(0, 10);
                    const [year, month, day] = soloFecha.split('-');
                    fechaAMostrar = `${day}/${month}/${year}`;
                }

                const textoEstado = alumno.estado == 1 ? 'Activo' : 'Pendiente';
                const claseEstado = alumno.estado == 1 ? 'status-al-dia' : 'status-pendiente';

                tr.innerHTML = `
            <td data-label="ALUMNO">${alumno.nombre} ${alumno.apellido}</td>
            <td data-label="ÚLTIMA ACTUALIZACIÓN">${fechaAMostrar}</td>
            <td data-label="ESTADO"><span class="status ${claseEstado}">${textoEstado}</span></td>
            <td data-label="ACCIONES" class="td-acciones">
            <div class="botones-container">
            <button class="btn-rutina btn-agregar" onclick="abrirModalAgregar(${alumno.id}, '${alumno.nombre} ${alumno.apellido}')">Agregar</button>
            <button class="btn-rutina btn-ver" onclick="verRutina(${alumno.id})">Ver</button>
            <button class="btn-rutina btn-editar" onclick="editarRutina(${alumno.id})">Editar</button>
            <button class="btn-rutina btn-borrar" onclick="borrarRutina(${alumno.id})">Borrar</button>
        </div>
    </td>
`;
                tbody.appendChild(tr);
            });
        });
});







// --- AJUSTE DE ESTILOS PARA EL CENTRADO PERFECTO ---
const styleCustom = document.createElement('style');
styleCustom.innerHTML = `
    /* Centra el texto del encabezado azul */
    th:last-child {
        text-align: center !important;
    }

    /* Centra el contenedor de botones en la celda */
    .td-acciones {
        text-align: center !important;
        vertical-align: middle;
    }

    .botones-container {
        display: inline-flex; /* Cambiado a inline-flex para respetar el text-align center */
        gap: 8px;
        justify-content: center;
        width: 100%;
    }

    /* Ajuste para que no se peguen en mobile */
    @media (max-width: 768px) {
        .botones-container {
            flex-direction: column;
            align-items: center;
        }
        .btn-rutina { width: 100%; max-width: 200px; }
    }
`;
document.head.appendChild(styleCustom);





function abrirModalAgregar(id, nombreCompleto) {
    // Referencias exactas a los IDs del HTML de arriba
    const spanNombre = document.getElementById('modalAlumnoNombre');
    const inputId = document.getElementById('modalAlumnoId');
    const modal = document.getElementById('modalRutina');

    if (spanNombre && inputId && modal) {
        spanNombre.innerText = nombreCompleto;
        inputId.value = id;
        modal.style.display = 'flex';
        ejerciciosTemporales = []; // Limpiamos lista previa
        renderizarListaEjercicios();
    } else {
        console.error("Error: No se encontraron los elementos del modal en el HTML.");
    }
}

let ejerciciosTemporales = [];

// Función para ir armando la lista en el modal
function agregarEjercicioALista() {
    const dia = document.getElementById('inputDia').value;
    const nombre = document.getElementById('inputEjercicio').value;
    const series = document.getElementById('inputSeries').value;
    const reps = document.getElementById('inputReps').value;
    const obs = document.getElementById('inputObs').value;

    if (!nombre || !series || !reps) {
        alert("Completá Ejercicio, Series y Repeticiones.");
        return;
    }

    // IMPORTANTE: Estos nombres de propiedad deben ser iguales en el server
    ejerciciosTemporales.push({ 
        dia: dia, 
        nombre: nombre, 
        series: series, 
        reps: reps, 
        obs: obs 
    });

    // Limpiar campos para el siguiente
    document.getElementById('inputEjercicio').value = '';
    document.getElementById('inputSeries').value = '';
    document.getElementById('inputReps').value = '';
    document.getElementById('inputObs').value = '';

    renderizarListaEjercicios();
}






function renderizarListaEjercicios() {
    const contenedor = document.getElementById('listaEjerciciosAgregados');
    contenedor.innerHTML = "";

    if (ejerciciosTemporales.length === 0) {
        contenedor.innerHTML = '<p style="color:#666; text-align:center;">No hay ejercicios agregados.</p>';
        return;
    }

    // Agrupamos los ejercicios por día
    const diasOrdenados = ["Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado"];
    
    diasOrdenados.forEach(dia => {
        const ejerciciosDelDia = ejerciciosTemporales.filter(e => e.dia === dia);
        
        if (ejerciciosDelDia.length > 0) {
            // Creamos el contenedor del día
            const divGrupo = document.createElement('div');
            divGrupo.className = "grupo-dia";
            
            let htmlEjercicios = `<div class="titulo-dia-lista">${dia}</div>`;
            
            ejerciciosDelDia.forEach(ej => {
                // Buscamos el índice original para poder borrarlo correctamente
                const originalIndex = ejerciciosTemporales.indexOf(ej);
                
                htmlEjercicios += `
                    <div class="ejercicio-item" style="display:flex; justify-content:space-between; background:#2a2a2a; padding:5px 10px; margin-bottom:3px; border-radius:4px; font-size:0.85em;">
                        <span>${ej.nombre} - <small>${ej.series}x${ej.reps}</small></span>
                        <button onclick="eliminarEjercicio(${originalIndex})" style="background:none; border:none; color:#ff4d4d; cursor:pointer;">&times;</button>
                    </div>
                `;
            });
            
            divGrupo.innerHTML = htmlEjercicios;
            contenedor.appendChild(divGrupo);
        }
    });
    contenedor.scrollTop = contenedor.scrollHeight;
}




function eliminarEjercicio(index) {
    ejerciciosTemporales.splice(index, 1);
    renderizarListaEjercicios();
}



function cerrarModal() {
    document.getElementById('modalRutina').style.display = 'none';
}













let listaEjerciciosTemp = [];
let idAlumnoActual = null;

function agregarRutina(idAlumno) {
    idAlumnoActual = idAlumno;
    
    // Buscamos los elementos por los IDs nuevos
    const modal = document.getElementById('modalAgregarRutina');
    const inputNombre = document.getElementById('nombrePlanGeneral');
    const vistaPrevia = document.getElementById('previsualizacionPlan');

    // Validación de seguridad para que no salga el error de "No encontrado"
    if (!modal || !inputNombre || !vistaPrevia) {
        alert("Error técnico: Faltan IDs en el HTML. Revisa la consola (F12).");
        console.error("IDs faltantes:", { modal, inputNombre, vistaPrevia });
        return;
    }

    // Limpiamos el modal para un nuevo uso
    inputNombre.value = "";
    listaEjerciciosTemp = [];
    vistaPrevia.innerHTML = '<p style="color: #888; text-align: center;">Comience a agregar ejercicios...</p>';
    
    modal.style.display = 'flex';
}




function agregarAListaTemporal() {
    const dia = document.getElementById('inputDia').value;
    const nombre = document.getElementById('inputNombreEj').value;
    const series = document.getElementById('inputSeries').value;
    const reps = document.getElementById('inputReps').value;

    if (!nombre || !series || !reps) {
        alert("Por favor, completa los datos del ejercicio.");
        return;
    }

    // Agregamos al array
    listaEjerciciosTemp.push({
        dia: dia,
        nombre_ejercicio: nombre,
        series: series,
        repeticiones: reps,
        observaciones: ""
    });

    // Limpiamos solo los campos del ejercicio
    document.getElementById('inputNombreEj').value = "";
    document.getElementById('inputSeries').value = "";
    document.getElementById('inputReps').value = "";

    actualizarVistaPrevia();
}

function actualizarVistaPrevia() {
    const contenedor = document.getElementById('previsualizacionPlan');
    contenedor.innerHTML = "";

    listaEjerciciosTemp.forEach((ej, index) => {
        const div = document.createElement('div');
        div.className = 'ejercicio-temp-item';
        div.innerHTML = `
            <span><b style="color:#4d94ff;">${ej.dia}:</b> ${ej.nombre_ejercicio} (${ej.series}x${ej.repeticiones})</span>
            <button onclick="eliminarDeListaTemp(${index})" style="background:none; border:none; color:#ff4d4d; cursor:pointer;">&times;</button>
        `;
        contenedor.appendChild(div);
    });
}

function eliminarDeListaTemp(index) {
    listaEjerciciosTemp.splice(index, 1);
    actualizarVistaPrevia();
}

function cerrarModalAgregar() {
    document.getElementById('modalAgregarRutina').style.display = 'none';
}















function guardarRutinaCompleta() {
    const alumnoId = document.getElementById('modalAlumnoId').value;
    const nombrePlan = document.getElementById('nombrePlan').value;
    const profesorId = localStorage.getItem('usuarioId'); 

    if (!nombrePlan || ejerciciosTemporales.length === 0) {
        alert("Por favor, poné un nombre al plan y agregá ejercicios.");
        return;
    }

    const datosARemitir = {
        alumno_id: alumnoId,
        nombre_plan: nombrePlan,
        profesor_id: profesorId,
        ejercicios: ejerciciosTemporales // Enviamos el array con 'dia' incluido
    };

    fetch('http://localhost:3000/api/guardar-rutina', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(datosARemitir)
    })
    .then(res => {
        if (!res.ok) throw new Error('Error en el servidor');
        return res.json();
    })
    .then(data => {
        alert("¡Plan semanal guardado correctamente!");
        cerrarModal();
        location.reload();
    })
    .catch(err => {
        console.error("Error al guardar:", err);
        alert("Error al guardar. Revisá la consola del servidor.");
    });
}






let ejerciciosConsulta = [];

async function verRutina(idAlumno) {
    const modal = document.getElementById('modalVerRutina');
    const selectPlanes = document.getElementById('selectorPlanesVer');
    const contenedor = document.getElementById('contenedorEjerciciosVer');

    try {
        // 1. Buscamos los Planes (headers) del alumno
        const res = await fetch(`http://localhost:3000/api/planes-alumno/${idAlumno}`);
        const planes = await res.json();

        if (planes.length === 0) {
            alert("El alumno no tiene planes asignados.");
            return;
        }

        // 2. Limpiamos el selector y el contenedor
        selectPlanes.innerHTML = '<option value="">-- Seleccione un Plan --</option>';
        contenedor.innerHTML = '<p style="text-align: center; color: #888;">Seleccione un plan para ver los detalles.</p>';

        // 3. Llenamos el selector de planes
        planes.forEach(plan => {
            const opt = document.createElement('option');
            opt.value = plan.id;
            opt.textContent = plan.nombre_plan;
            selectPlanes.appendChild(opt);
        });

        // 4. Abrimos el modal
        modal.style.display = 'flex';

    } catch (error) {
        console.error("Error al cargar planes para ver:", error);
    }
}

async function mostrarEjerciciosEnVer() {
    const planId = document.getElementById('selectorPlanesVer').value;
    const contenedor = document.getElementById('contenedorEjerciciosVer');

    try {
        const res = await fetch(`http://localhost:3000/api/ejercicios-plan/${planId}`);
        const ejercicios = await res.json();
        contenedor.innerHTML = '';

        // Definimos el orden de los días para iterar
        const diasSemana = ["Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado"];
        
        diasSemana.forEach(dia => {
            // Filtramos ejercicios que pertenecen a este día
            const ejerciciosDelDia = ejercicios.filter(e => e.dia === dia);
            
            if (ejerciciosDelDia.length > 0) {
                // Creamos un separador estético para el día
                const divDia = document.createElement('div');
                divDia.innerHTML = `<h4 style="color: #4d94ff; margin: 15px 0 10px 0; border-bottom: 1px solid #444;">${dia}</h4>`;
                contenedor.appendChild(divDia);

                // Insertamos los ejercicios de ese día
                ejerciciosDelDia.forEach(ej => {
                    const item = document.createElement('div');
                    item.className = 'ejercicio-item-consulta';
                    item.style = "background: #2a2a2a; padding: 10px; margin-bottom: 8px; border-radius: 8px;";
                    item.innerHTML = `
                        <p style="margin:0;"><strong>${ej.nombre_ejercicio}</strong></p>
                        <small style="color: #bbb;">${ej.series} series x ${ej.repeticiones} reps</small>
                    `;
                    contenedor.appendChild(item);
                });
            }
        });

    } catch (error) { console.error("Error visualizando:", error); }
}




function cerrarModalVer() {
    document.getElementById('modalVerRutina').style.display = 'none';
}



// Al cargar la página, nos aseguramos de que el modal esté oculto
document.addEventListener('DOMContentLoaded', () => {
    const modal = document.getElementById('modalEdicionUnico');
    if (modal) modal.style.display = 'none';
    
    // Llamamos a la función que carga la tabla
    cargarTablaEjercicios();
});

// FUNCIÓN PARA CARGAR LA TABLA (Aquí es donde estaba el error de nombre)
async function cargarTablaEjercicios() {
    const cuerpoTabla = document.getElementById('cuerpoTablaEjercicios'); // Asegurate que este ID exista en tu HTML
    if (!cuerpoTabla) return;

    try {
        const res = await fetch('http://localhost:3000/api/tus-rutinas'); // Cambiá por tu URL real
        const rutinas = await res.json();

        cuerpoTabla.innerHTML = ''; // Limpiamos la tabla

        rutinas.forEach(rutina => {
            const tr = document.createElement('tr');
            // Aquí definimos el botón con el nombre CORRECTO: abrirModalEdicion
            tr.innerHTML = `
                <td>${rutina.ejercicio}</td>
                <td>${rutina.series}</td>
                <td>${rutina.repeticiones}</td>
                <td>${rutina.observaciones || ''}</td>
                <td>
                    <button class="btn-editar" onclick="abrirModalEdicion(${rutina.id}, '${rutina.ejercicio}', ${rutina.series}, '${rutina.repeticiones}', '${rutina.observaciones}')">
                        Editar
                    </button>
                </td>
            `;
            cuerpoTabla.appendChild(tr);
        });
    } catch (error) {
        console.error("Error al cargar la tabla:", error);
    }
}

// FUNCIÓN PARA ABRIR EL MODAL (La que el botón busca y no encontraba)







// Esto fuerza que el modal esté oculto apenas carga el script
document.addEventListener('DOMContentLoaded', () => {
    const modal = document.getElementById('modalEdicionUnico');
    if (modal) modal.style.setProperty('display', 'none', 'important');
});





// 1. SEGURIDAD: Forzar que el modal esté oculto al cargar la página
document.addEventListener('DOMContentLoaded', () => {
    const modal = document.getElementById('modalEdicionUnico');
    if (modal) {
        modal.style.setProperty('display', 'none', 'important');
    }
});

// 2. FUNCIÓN PARA CERRAR EL MODAL (Botón rojo)
function cerrarModalEdicion() {
    const modal = document.getElementById('modalEdicionUnico');
    if (modal) {
        modal.style.setProperty('display', 'none', 'important');
    }
}

// 3. FUNCIÓN PARA ABRIR EL MODAL (La que el botón ahora sí va a encontrar)
function abrirModalEditar(idRutina) {
    // 1. Pedimos los datos al servidor
    fetch(`http://localhost:3000/api/obtener-rutina-detalle/${idRutina}`)
        .then(res => res.json())
        .then(data => {
            ejerciciosCargadosParaEditar = data; // Guardamos todo el plan
            document.getElementById('modalEditarRutina').style.display = 'flex';
            
            // Forzamos que empiece en Lunes (o el día que quieras)
            document.getElementById('filtroDiaEditar').value = "Lunes";
            renderizarEjerciciosEdicion(); 
        })
        .catch(err => console.error("Error al cargar rutina:", err));
    }







// Función para cerrar (la que pide tu botón "Cerrar")
function cerrarModalEdicion() {
    document.getElementById('modalEdicionUnico').style.display = 'none';
}



let planesDelAlumno = []; // Para guardar los headers (id, nombre_plan)



ejerciciosDelPlanActual = [];

async function editarRutina(idAlumno) {
    const modal = document.getElementById('modalEdicionUnico');
    const selectPlanes = document.getElementById('selectorPlanes');

    try {
        const res = await fetch(`http://localhost:3000/api/planes-alumno/${idAlumno}`);
        const planesDelAlumno = await res.json();

        if (planesDelAlumno.length === 0) {
            alert("El alumno no tiene planes creados.");
            return;
        }

        // Llenamos selector de planes
        selectPlanes.innerHTML = '<option value="">-- Seleccione un Plan --</option>';
        planesDelAlumno.forEach(plan => {
            const opt = document.createElement('option');
            opt.value = plan.id;
            opt.textContent = plan.nombre_plan;
            selectPlanes.appendChild(opt);
        });

        modal.style.setProperty('display', 'flex', 'important');
    } catch (error) {
        console.error("Error:", error);
    }
}









function cargarDatosEjercicioIndividual() {
    const idEjercicio = document.getElementById('selectorEjercicios').value;
    if (!idEjercicio) return;

    const ej = ejerciciosDelPlanActual.find(item => item.id == idEjercicio);

    if (ej) {
        document.getElementById('editId').value = ej.id;
        document.getElementById('editNombre').value = ej.nombre_ejercicio;
        document.getElementById('editSeries').value = ej.series;
        document.getElementById('editReps').value = ej.repeticiones;
        document.getElementById('editObs').value = ej.observaciones || "";
    }
}



function cargarDatosEjercicioSeleccionado() {
    const idSeleccionado = document.getElementById('selectorEjercicios').value;
    
    // Buscamos los datos en nuestro array local
    const ej = ejerciciosDelAlumnoActual.find(item => item.id == idSeleccionado);

    if (ej) {
        document.getElementById('editId').value = ej.id;
        document.getElementById('editNombre').value = ej.nombre_ejercicio;
        document.getElementById('editSeries').value = ej.series;
        document.getElementById('editReps').value = ej.repeticiones;
        document.getElementById('editObs').value = ej.observaciones;
    }
}





async function guardarCambios() {
    const idEjercicio = document.getElementById('editId').value;
    
    const datosEditados = {
        nombre: document.getElementById('editNombre').value,
        series: document.getElementById('editSeries').value,
        reps: document.getElementById('editReps').value,
        obs: document.getElementById('editObs').value
    };

    if (!idEjercicio) {
        alert("Seleccioná un ejercicio primero");
        return;
    }

    try {
        const res = await fetch(`http://localhost:3000/api/actualizar-ejercicio/${idEjercicio}`, {
            method: 'PUT', // IMPORTANTE: Debe ser PUT
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(datosEditados)
        });

        if (!res.ok) throw new Error("Error en la respuesta del servidor");

        const resultado = await res.json();

        if (resultado.success) {
            alert("¡Cambios guardados con éxito!");
            // Refrescamos la lista local para que los cambios se vean reflejados
            await cargarEjerciciosDelPlan(); 
        } else {
            alert("Error: " + resultado.error);
        }
    } catch (error) {
        console.error("Error al guardar:", error);
        alert("No se pudo conectar con el servidor para guardar.");
    }
}


// Abrir el modal y cargar los planes
async function borrarRutina(idAlumno) {
    const modal = document.getElementById('modalBorrarPlan');
    const selector = document.getElementById('selectorPlanesBorrar');

    try {
        const res = await fetch(`http://localhost:3000/api/planes-alumno/${idAlumno}`);
        const planes = await res.json();

        if (planes.length === 0) {
            alert("El alumno no tiene planes para borrar.");
            return;
        }

        // Llenamos el selector
        selector.innerHTML = '<option value="">-- Seleccione un Plan --</option>';
        planes.forEach(p => {
            const opt = document.createElement('option');
            opt.value = p.id;
            opt.textContent = p.nombre_plan;
            selector.appendChild(opt);
        });

        modal.style.display = 'flex';
    } catch (error) {
        console.error("Error al cargar planes:", error);
    }
}

// Ejecutar la eliminación
async function ejecutarBorrado() {
    const idPlan = document.getElementById('selectorPlanesBorrar').value;

    if (!idPlan) {
        alert("Por favor, seleccione un plan.");
        return;
    }

    if (confirm("¿Estás seguro? Se borrarán todos los ejercicios asociados a este plan.")) {
        try {
            const res = await fetch(`http://localhost:3000/api/eliminar-plan/${idPlan}`, {
                method: 'DELETE'
            });

            if (res.ok) {
                alert("Plan eliminado correctamente.");
                cerrarModalBorrar();
                // Aquí podrías recargar la tabla de alumnos si fuera necesario
            } else {
                alert("Error al eliminar el plan.");
            }
        } catch (error) {
            console.error("Error:", error);
        }
    }
}

function cerrarModalBorrar() {
    document.getElementById('modalBorrarPlan').style.display = 'none';
}


</script>

<div id="modalRutina" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <h3 style="text-align: center; margin-bottom: 20px;">Plan Semanal: <span id="modalAlumnoNombre" style="color: #4d94ff;"></span></h3>
        <input type="hidden" id="modalAlumnoId">

        <div class="plan-header-box">
            <label class="label-sutil">Nombre General del Plan:</label>
            <input type="text" id="nombrePlan" placeholder="Ej: Hipertrofia Marzo" class="input-moderno">
        </div>

        <div id="listaEjerciciosAgregados" class="scroll-estetico">
            </div>

        <div class="form-carga-ejercicio">
            
            <div style="margin-bottom: 15px;">
                <label class="label-sutil">Día de entrenamiento:</label>
                <select id="inputDia" class="select-dia-grande">
                    <option value="Lunes">Lunes</option>
                    <option value="Martes">Martes</option>
                    <option value="Miércoles">Miércoles</option>
                    <option value="Jueves">Jueves</option>
                    <option value="Viernes">Viernes</option>
                    <option value="Sábado">Sábado</option>
                </select>
            </div>

            <div style="margin-bottom: 15px;">
                <label class="label-sutil">Ejercicio:</label>
                <input type="text" id="inputEjercicio" placeholder="Nombre del ejercicio..." class="input-moderno">
            </div>

            <div class="grid-inputs-pequeños">
                <div>
                    <label class="label-sutil">Series:</label>
                    <input type="number" id="inputSeries" class="input-moderno">
                </div>
                <div>
                    <label class="label-sutil">Reps:</label>
                    <input type="text" id="inputReps" class="input-moderno">
                </div>
                <div>
                    <label class="label-sutil">Obs:</label>
                    <input type="text" id="inputObs" class="input-moderno">
                </div>
            </div>

            <button type="button" onclick="agregarEjercicioALista()" class="btn-añadir-pro">
                + Añadir ejercicio al plan
            </button>
        </div>

        <div class="modal-buttons" style="margin-top: 20px; border-top: 1px solid #333; padding-top: 20px;">
            <button onclick="guardarRutinaCompleta()" class="btn-guardar">Guardar Todo el Plan</button>
            <button onclick="cerrarModal()" class="btn-cancelar">Cancelar</button>
        </div>
    </div>
</div>





<div id="modalVerRutina" class="modal-ver-rutina" style="display: none;">
    <div class="modal-content">
        <h3>Consulta de Rutinas</h3>
        
        <label>Seleccionar Plan para visualizar:</label>
        <select id="selectorPlanesVer" onchange="mostrarEjerciciosEnVer()" style="width: 100%; margin-bottom: 20px; padding: 10px; border-radius: 5px;">
            <option value="">-- Seleccione un Plan --</option>
        </select>

        <hr>

        <div id="contenedorEjerciciosVer">
            <p style="text-align: center; color: #888;">Seleccione un plan para ver los detalles.</p>
        </div>

        <div class="modal-buttons">
            <button onclick="cerrarModalVer()" class="btn-cancelar">Cerrar</button>
        </div>
    </div>
</div>


<div id="modalEdicionUnico" class="modal-edicion-unico" style="display: none;">
    <div class="modal-content">
        <h3>Editar Rutina</h3>

        <label>1. Seleccionar Plan (Rutina):</label>
        <select id="selectorPlanes" onchange="cargarEjerciciosDelPlan()" style="width: 100%; margin-bottom: 10px; padding: 8px;">
            <option value="">-- Seleccione un Plan --</option>
        </select>

        <label>2. Filtrar por Día:</label>
        <select id="filtroDiaEditar" onchange="actualizarListaPorDia()" style="width: 100%; margin-bottom: 10px; padding: 8px;">
            <option value="Lunes">Lunes</option>
            <option value="Martes">Martes</option>
            <option value="Miércoles">Miércoles</option>
            <option value="Jueves">Jueves</option>
            <option value="Viernes">Viernes</option>
            <option value="Sábado">Sábado</option>
        </select>

        <label>3. Seleccionar Ejercicio:</label>
        <select id="selectorEjercicios" onchange="cargarDatosEjercicioIndividual()" style="width: 100%; margin-bottom: 15px; padding: 8px;" disabled>
            <option value="">-- Primero elija un plan --</option>
        </select>

        <hr>

        <input type="hidden" id="editId">
        <label>Nombre del Ejercicio:</label>
        <input type="text" id="editNombre" class="input-moderno">

        <div class="modal-grid-row">
            <div style="flex: 1;">
                <label>Series:</label>
                <input type="number" id="editSeries" class="input-moderno">
            </div>
            <div style="flex: 1;">
                <label>Reps:</label>
                <input type="text" id="editReps" class="input-moderno">
            </div>
        </div>

        <div style="width: 100%; margin-top: 15px;">
    <label class="label-sutil" style="display: block; margin-bottom: 5px;">Observaciones:</label>
    <textarea id="editObs" rows="5" class="input-moderno-area" placeholder="Detalles del ejercicio..."></textarea>
</div>
        <div class="modal-buttons">
            <button onclick="guardarCambios()" class="btn-guardar">Actualizar</button>
            <button onclick="cerrarModalEdicion()" class="btn-cancelar">Cerrar</button>
        </div>
    </div>
</div>


<div id="modalBorrarPlan" class="modal-overlay">
    <div class="modal-content" style="max-width: 400px;">
        <h3 style="color: #ff4d4d;">Eliminar Plan</h3>
        <p style="text-align: center; color: #bbb;">Seleccione el plan que desea eliminar permanentemente:</p>
        
        <label>Plan a borrar:</label>
        <select id="selectorPlanesBorrar" style="border-color: #555; margin-bottom: 20px;">
            <option value="">-- Seleccione un Plan --</option>
        </select>

        <div class="modal-buttons">
            <button onclick="ejecutarBorrado()" class="btn-borrar" style="flex: 2;">Eliminar Plan</button>
            <button onclick="cerrarModalBorrar()" class="btn-cancelar" style="flex: 1;">Cancelar</button>
        </div>
    </div>
</div>



</body>
</html>






























